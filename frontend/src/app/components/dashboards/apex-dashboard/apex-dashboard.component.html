<div class="dashboard-container">
  <div class="sidebar">
    <app-sidebar-menu></app-sidebar-menu>
  </div>

  <div class="main-content">
    <p-card header="Apex Dashboard" class="m-4">
      <p><strong>Welcome to the Apex Dashboard!</strong></p>

      <p-tabView>
        <!-- Tab 1: Assign Functionalities -->
        <p-tabPanel header="Assign Functionalities">
          <div class="p-fluid mt-4">
            <!-- Role Dropdown -->
            <div class="p-field mb-3">
              <label for="role">Select Role <span class="text-danger">*</span></label>
              <p-dropdown
                id="role"
                [options]="roles"
                [(ngModel)]="selectedRole"
                placeholder="Select a role"
                (onChange)="onRoleChange()"
                [showClear]="true">
              </p-dropdown>
            </div>

            <!-- Username Dropdown -->
            <div class="p-field mb-3">
              <label for="username">Select Username <span class="text-danger">*</span></label>
              <p-dropdown
                id="username"
                [options]="users"
                [(ngModel)]="selectedUser"
                optionLabel="userName"
                placeholder="Select a user"
                (onChange)="onUsernameChange()"
                [disabled]="users.length === 0"
                [showClear]="true">
              </p-dropdown>
            </div>

            <button
              pButton
              label="Get Functionalities"
              (click)="searchUser()"
              [disabled]="!selectedUser">
            </button>

            <div *ngIf="user" class="mt-4">
              <div *ngFor="let func of roleFunctionalities" class="mb-2">
                <p-checkbox
                  [binary]="true"
                  [label]="func"
                  [ngModel]="isChecked(func)"
                  (onChange)="onToggle(func, $event)">
                </p-checkbox>
              </div>

              <button
                pButton
                label="Save Changes"
                class="mt-3"
                (click)="saveChanges()">
              </button>
            </div>
          </div>
        </p-tabPanel>

        <!-- Tab 2: Add New Data -->
        <p-tabPanel header="Add New Data">
          <div class="p-fluid mt-4">
            <!-- New Role -->
            <div class="p-field mb-3">
              <label for="newRole">New Role Name <span class="text-danger">*</span></label>
              <input
                id="newRole"
                type="text"
                pInputText
                [(ngModel)]="newRoleName" />
            </div>

            <!-- New Functionalities -->
            <div class="p-field mb-3">
              <label>New Functionalities <span class="text-danger" *ngIf="!roles.includes(newRoleName.trim())">*</span></label>
              <div
                *ngFor="let func of newFunctionalities; let i = index; trackBy: trackByIndex"
                class="p-inputgroup mb-2">
                <input
                  type="text"
                  pInputText
                  [(ngModel)]="newFunctionalities[i]" />

                <button
                  pButton
                  icon="pi pi-plus"
                  class="p-button-sm"
                  type="button"
                  (click)="addFunctionalityField()">
                </button>

                <button
                  pButton
                  icon="pi pi-minus"
                  class="p-button-sm p-button-danger"
                  type="button"
                  (click)="removeFunctionalityField(i)"
                  [disabled]="newFunctionalities.length === 1">
                </button>
              </div>
            </div>

            <!-- New Username -->
            <div class="p-field mb-3">
              <label for="newUser">
                New Username
                <span
                  class="text-danger"
                  *ngIf="!roles.includes(newRoleName.trim())">
                  *
                </span>
                <span
                  class="text-muted"
                  *ngIf="roles.includes(newRoleName.trim())">
                  (optional)
                </span>
              </label>
              <input
                id="newUser"
                type="text"
                pInputText
                [(ngModel)]="newUsername" />
            </div>

            <button
              pButton
              label="Submit"
              class="mt-2"
              (click)="submitNewData()">
            </button>
          </div>
        </p-tabPanel>
      </p-tabView>
    </p-card>
  </div>
</div>
